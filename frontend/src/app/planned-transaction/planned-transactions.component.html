<div class="buttons">

  <div class="float-left">
    <button (click)="addingMode = !addingMode"
            class="btn btn-success"
            id="AddTransactionBtn"
            type="button">
      {{'transaction.addPlannedTransaction' | translate}}
    </button>
    <button (click)="getTransactions()"
            class="btn btn-primary"
            id="RefreshTransactionsBtn"
            type="button">{{'button.refresh' | translate}}</button>
  </div>

  <div class="form-inline float-right">
    <select (ngModelChange)="onFilterChange($event)"
            [(ngModel)]="originalFilter"
            class="form-control">
      <option *ngFor="let filter of filters"
              [ngValue]="filter">
        {{filter.name}}
      </option>
    </select>
    <input [(ngModel)]="selectedFilter.name"
           class="form-control"
           type="text"/>
    <button (click)="addFilter()"
            class="btn btn-success"
            id="AddFilterBtn">{{'transaction.save' | translate}}</button>
    <button (click)="updateFilter()"
            class="btn btn-warning"
            id="UpdateFilterBtn">{{'transaction.update' | translate}}</button>
    <button (click)="resetFilter()"
            class="btn btn-primary"
            id="ResetFilterBtn">{{'transaction.reset' | translate}}</button>
    <button (click)="deleteFilter()"
            class="btn btn-danger"
            id="DeleteFilterBtn">{{'transaction.delete' | translate}}</button>
  </div>

</div>

<table class="table table-bordered table-striped table-hover">
  <thead class="thead-dark">
    <tr>

      <!--Date-->
      <th (click)="setOrder('date')"
          [class.active]="order === 'date'"
          class="width15"
          id="DateHeader">
        {{'transaction.date' | translate}}
        <span [hidden]="!reverse">▼</span>
        <span [hidden]="reverse">▲</span>
      </th>

      <!--Description-->
      <th (click)="setOrder('description')"
          [class.active]="order === 'description'"
          class="width20"
          id="NameHeader">
        {{'transaction.description' | translate}}
        <span [hidden]="!reverse">▼</span>
        <span [hidden]="reverse">▲</span>
      </th>

      <!--Price-->
      <th (click)="setOrder('accountPriceEntries[0].pricePLN')"
          [class.active]="order === 'accountPriceEntries[0].pricePLN'"
          class="width15"
          id="PriceHeader">
        {{ 'transaction.price' | translate}}
        <span [hidden]="!reverse">▼</span>
        <span [hidden]="reverse">▲</span>
      </th>

      <!--Account-->
      <th (click)="setOrder('accountPriceEntries[0].account.name')"
          [class.active]="order === 'accountPriceEntries[0].account.name'"
          class="width15"
          id="AccountHeader">
        {{'transaction.account' | translate}}
        <span [hidden]="!reverse">▼</span>
        <span [hidden]="reverse">▲</span>
      </th>

      <!--Category-->
      <th (click)="setOrder('category.name')"
          [class.active]="order === 'category.name'"
          class="width20"
          id="CategoryHeader">
        {{'transaction.category' | translate}}
        <span [hidden]="!reverse">▼</span>
        <span [hidden]="reverse">▲</span>
      </th>

      <th class="width15">
      </th>
    </tr>

  </thead>
  <tbody>

    <!-- Filters -->
    <tr>

      <!--Date-->
      <td>
        <input (ngModelChange)="filterPlannedTransactions()"
               [(ngModel)]="selectedFilter.dateFrom"
               class="form-control"
               max="2025-12-31"
               min="2015-01-01"
               type="date">
        <input (ngModelChange)="filterPlannedTransactions()"
               [(ngModel)]="selectedFilter.dateTo"
               class="form-control"
               max="2025-12-31"
               min="2015-01-01"
               type="date">
      </td>

      <!--Description-->
      <td>
        <input (ngModelChange)="filterPlannedTransactions()"
               [(ngModel)]="selectedFilter.description"
               class="form-control"
               type="text">
      </td>

      <!--Price-->
      <td>
        <input (ngModelChange)="filterPlannedTransactions()"
               [(ngModel)]="selectedFilter.priceFrom"
               class="form-control"
               type="number">
        <input (ngModelChange)="filterPlannedTransactions()"
               [(ngModel)]="selectedFilter.priceTo"
               class="form-control"
               type="number">
      </td>

      <!--Account-->
      <td>
        <select (ngModelChange)="filterPlannedTransactions()"
                [(ngModel)]="selectedFilter.accounts"
                class="form-control"
                multiple>
          <ng-container *ngFor="let account of accounts">

            <option *ngIf="!account.archived"
                    [ngValue]="account">
              {{account.name}}
            </option>
          </ng-container>
        </select>
      </td>

      <!--Category-->
      <td>
        <select (ngModelChange)="filterPlannedTransactions()"
                [(ngModel)]="selectedFilter.categories"
                class="form-control"
                multiple>
          <option *ngFor="let category of categories"
                  [ngValue]="category">
            {{category.name}}
          </option>
        </select>
      </td>

      <td>
      </td>
    </tr>

    <tr *ngIf="addingMode">
      <!--Date-->
      <td>
        <input (ngModelChange)="newTransaction.date = parseDate($event)"
               [ngModel]="newTransaction.date | date:'yyyy-MM-dd'"
               class="form-control"
               id="NewTransactionDateInput"
               max="2025-12-31"
               min="2015-01-01"
               type="date">
      </td>

      <!--Description-->
      <td>
        <input [(ngModel)]="newTransaction.description"
               class="form-control"
               id="NewTransactionDescriptionInput"
               type="text">
      </td>

      <!--Price-->
      <td>
        <input *ngFor="let entry of newTransaction.accountPriceEntries"
               [(ngModel)]="entry.price"
               class="form-control"
               id="NewTransactionPriceInput"
               type="number">
        <!--<input type="number" min="0.00" max="10000.00" step="0.01" />-->
      </td>

      <!--Account-->
      <td>
        <select *ngFor="let entry of newTransaction.accountPriceEntries"
                [(ngModel)]="entry.account"
                class="form-control"
                id="newTransactionAccountSelects">
          <ng-container *ngFor="let account of accounts">
            <option *ngIf="!account.archived"
                    [ngValue]="account">
              {{account.name}}
            </option>
          </ng-container>
        </select>
      </td>

      <!--Category-->
      <td>
        <select [(ngModel)]="newTransaction.category"
                class="form-control"
                id="newTransactionCategorySelect">
          <option *ngFor="let category of categories"
                  [ngValue]="category">
            {{category.name}}
          </option>
        </select>
      </td>

      <td id="EditAccountSaveExitBtn">
        <button (click)="addPlannedTransaction()"
                class="btn btn-success"
                id="newTransactionSaveButton">{{'button.save' | translate}}</button>
        <button (click)="addingMode=false"
                class="btn btn-danger"
                id="AddTransactionExitBtn">{{'button.exit' | translate}}</button>
      </td>
    </tr>

    <tr *ngFor="let transaction of transactions | orderBy: order:reverse:'case-insensitive'"
        id="TransactionRow">

      <!--      <ng-container *ngIf="!transaction.planned">-->

      <!--      <div *ngIf="!transaction.isPlanned">-->
      <ng-container *ngIf="transaction.isPlanned">

        <!--Date-->
        <td *ngIf="!transaction.editMode"
            id="DateReadOnly">{{transaction.date | date:'dd/MM/yyyy'}}</td>
        <td *ngIf="transaction.editMode">
          <input [(ngModel)]="transaction.editedTransaction.date"
                 class="form-control"
                 id="EditTransactionDateInput"
                 max="2025-12-31"
                 min="2015-01-01"
                 type="date">
        </td>

        <!--Description-->
        <td *ngIf="!transaction.editMode"
            id="DescriptionReadOnly">{{transaction.description}}</td>
        <td *ngIf="transaction.editMode">
          <input [(ngModel)]="transaction.editedTransaction.description"
                 class="form-control"
                 id="EditTransactionDescriptionInput"
                 type="text">
        </td>

        <!--Price-->
        <td *ngIf="!transaction.editMode"
            class="right aligned">
          <p *ngFor="let entry of transaction.accountPriceEntries"
             id="PricesReadOnly">
            {{entry.price | number:'0.2'}} {{entry.account.currency.name}}
            <span *ngIf="entry.account.currency.name != 'PLN'">({{entry.pricePLN | number:'0.2'}}
              PLN)</span>
          </p>
        </td>
        <td *ngIf="transaction.editMode">
          <input *ngFor="let entry of transaction.editedTransaction.accountPriceEntries"
                 [(ngModel)]="entry.price"
                 class="form-control"
                 id="EditTransactionPriceInput"
                 type="number">
        </td>

        <!--Account-->
        <td *ngIf="!transaction.editMode">
          <p *ngFor="let entry of transaction.accountPriceEntries"
             id="AccountsReadOnly">
            {{entry.account.name}}
          </p>
        </td>
        <td *ngIf="transaction.editMode">
          <select *ngFor="let entry of transaction.editedTransaction.accountPriceEntries"
                  [(ngModel)]="entry.account"
                  class="form-control"
                  id="EditTransactionAccountSelects">
            <option *ngFor="let account of accounts"
                    [ngValue]="account">
              {{account.name}}
            </option>
          </select>
        </td>

        <!--Category-->
        <td *ngIf="!transaction.editMode"
            id="CategoryReadOnly">
          {{transaction.category.name}}
        </td>
        <td *ngIf="transaction.editMode"
            id="EditTransactionCategorySelect">
          <select [(ngModel)]="transaction.editedTransaction.category"
                  class="form-control">
            <option *ngFor="let category of categories"
                    [ngValue]="category">
              {{category.name}}
            </option>
          </select>
        </td>

        <td *ngIf="transaction.editMode">
          <button (click)="updateTransaction(transaction)"
                  class="btn btn-success"
                  id="EditTransactionSaveBtn">
            {{'button.save' | translate}}
          </button>
          <button (click)="transaction.editMode=false"
                  class="btn btn-danger"
                  id="EditTransactionExitBtn">
            {{'button.exit' | translate}}
          </button>
        </td>

        <td *ngIf="!transaction.editMode">
          <div class="dropdown">
            <button class="btn btn-primary dropdown-toggle btn-block"
                    data-toggle="dropdown"
                    id="OptionsBtn"
                    type="button">
              {{'button.options' | translate}}
              <span class="caret"></span>
            </button>
            <ul class="dropdown-menu">
              <li>
                <button (click)="onShowEditMode(transaction)"
                        class="btn btn-warning btn-block"
                        id="EditBtn">
                  {{'button.edit' | translate}}
                </button>
              </li>
              <li>
                <button (click)="deleteTransaction(transaction)"
                        class="btn btn-danger btn-block"
                        id="DeleteBtn">
                  {{'button.delete' | translate}}
                </button>
              </li>
              <li>
                <button (click)="commitPlannedTransaction(transaction)"
                        class="btn btn-success btn-block"
                        id="CommitBtn">
                  {{'button.commitPlannedTransaction' | translate}}
                </button>
              </li>
            </ul>
          </div>
        </td>
      </ng-container>
    </tr>
    <tr>
      <!--Date-->
      <td>
      </td>

      <!--Description-->
      <td>
        {{ "account.total" | translate }}
      </td>

      <!--Price-->
      <td class="right aligned bold">
        <p id="PriceSummary">
          {{ allFilteredPlannedTransactionsBalance() | number:'0.2' }}</p>
      </td>

      <!--Account-->
      <td>
      </td>

      <!--Category-->
      <td>
      </td>

      <!-- Buttons -->
      <td>
      </td>
    </tr>

  </tbody>
</table>
