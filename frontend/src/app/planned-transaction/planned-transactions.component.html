<div class="buttons">

  <div class="float-left">
    <button id="AddTransactionBtn"
            class="btn btn-success"
            type="button"
            (click)="addingMode = !addingMode">
      {{'plannedTransaction.addTransaction' | translate}}
    </button>
    <button id="RefreshTransactionsBtn"
            class="btn btn-primary"
            type="button"
            (click)="getPlannedTransactions()">{{'button.refresh' | translate}}</button>
  </div>

  <div class="form-inline float-right">
    <select class="form-control"
            [(ngModel)]="originalFilter"
            (ngModelChange)="onFilterChange($event)">
      <option *ngFor="let filter of filters"
              [ngValue]="filter">
        {{filter.name}}
      </option>
    </select>
    <input class="form-control"
           type="text"
           [(ngModel)]="selectedPlannedFilter.name"/>
    <button id="AddFilterBtn"
            class="btn btn-success"
            (click)="addFilter()">{{'plannedTransaction.save' | translate}}</button>
    <button id="UpdateFilterBtn"
            class="btn btn-warning"
            (click)="updateFilter()">{{'plannedTransaction.update' | translate}}</button>
    <button id="ResetFilterBtn"
            class="btn btn-primary"
            (click)="resetFilter()">{{'plannedTransaction.reset' | translate}}</button>
    <button id="DeleteFilterBtn"
            class="btn btn-danger"
            (click)="deleteFilter()">{{'plannedTransaction.delete' | translate}}</button>
  </div>

</div>

<table class="table table-bordered table-striped table-hover">
  <thead class="thead-dark">
    <tr>

      <!--Date-->
      <th id="DateHeader"
          class="width15"
          [class.active]="order === 'date'"
          (click)="setOrder('date')">
        {{'plannedTransaction.date' | translate}}
        <span [hidden]="!reverse">▼</span>
        <span [hidden]="reverse">▲</span>
      </th>

      <!--Description-->
      <th id="NameHeader"
          [class.active]="order === 'description'"
          (click)="setOrder('description')"
          class="width20">
        {{'plannedTransaction.description' | translate}}
        <span [hidden]="!reverse">▼</span>
        <span [hidden]="reverse">▲</span>
      </th>

      <!--Price-->
      <th id="PriceHeader"
          [class.active]="order === 'accountPriceEntries[0].pricePLN'"
          (click)="setOrder('accountPriceEntries[0].pricePLN')"
          class="width15">
        {{ 'plannedTransaction.price' | translate}}
        <span [hidden]="!reverse">▼</span>
        <span [hidden]="reverse">▲</span>
      </th>

      <!--Account-->
      <th id="AccountHeader"
          [class.active]="order === 'accountPriceEntries[0].account.name'"
          (click)="setOrder('accountPriceEntries[0].account.name')"
          class="width15">
        {{'plannedTransaction.account' | translate}}
        <span [hidden]="!reverse">▼</span>
        <span [hidden]="reverse">▲</span>
      </th>

      <!--Projected account balance by due date-->




      <!--Category-->
      <th id="CategoryHeader"
          [class.active]="order === 'category.name'"
          (click)="setOrder('category.name')"
          class="width20">
        {{'plannedTransaction.category' | translate}}
        <span [hidden]="!reverse">▼</span>
        <span [hidden]="reverse">▲</span>
      </th>

      <th class="width15">
      </th>
    </tr>

  </thead>
  <tbody>

    <!-- Filters -->
    <tr>

      <!--Date-->
      <td>
        <input class="form-control"
               type="date"
               min="2015-01-01"
               max="2025-12-31"
               [(ngModel)]="selectedPlannedFilter.dateFrom"
               (ngModelChange)="filterPlannedTransactions()">
        <input class="form-control"
               type="date"
               min="2015-01-01"
               max="2025-12-31"
               [(ngModel)]="selectedPlannedFilter.dateTo"
               (ngModelChange)="filterPlannedTransactions()">
      </td>

      <!--Description-->
      <td>
        <input class="form-control"
               type="text"
               [(ngModel)]="selectedPlannedFilter.description"
               (ngModelChange)="filterPlannedTransactions()">
      </td>

      <!--Price-->
      <td>
        <input class="form-control"
               type="number"
               [(ngModel)]="selectedPlannedFilter.priceFrom"
               (ngModelChange)="filterPlannedTransactions()">
        <input class="form-control"
               type="number"
               [(ngModel)]="selectedPlannedFilter.priceTo"
               (ngModelChange)="filterPlannedTransactions()">
      </td>

      <!--Account-->
      <td>
        <select multiple
                class="form-control"
                [(ngModel)]="selectedPlannedFilter.accounts"
                (ngModelChange)="filterPlannedTransactions()">
          <option *ngFor="let account of accounts"
                  [ngValue]="account">
            {{account.name}}
          </option>
        </select>
      </td>

      <!--Category-->
      <td>
        <select multiple
                class="form-control"
                [(ngModel)]="selectedPlannedFilter.categories"
                (ngModelChange)="filterPlannedTransactions()">
          <option *ngFor="let category of categories"
                  [ngValue]="category">
            {{category.name}}
          </option>
        </select>
      </td>

      <td>
      </td>
    </tr>

    <tr *ngIf="addingMode">
      <!--Date-->
      <td>
        <input id="NewTransactionDateInput"
               class="form-control"
               type="date"
               min="2015-01-01"
               max="2025-12-31"
               [ngModel]="newPlannedTransaction.date | date:'yyyy-MM-dd'"
               (ngModelChange)="newPlannedTransaction.date = parseDate($event)">
      </td>

      <!--Description-->
      <td>
        <input id="NewTransactionDescriptionInput"
               class="form-control"
               type="text"
               [(ngModel)]="newPlannedTransaction.description">
      </td>

      <!--Price-->
      <td>
        <input id="NewTransactionPriceInput"
               *ngFor="let entry of newPlannedTransaction.accountPriceEntries"
               class="form-control"
               type="number"
               [(ngModel)]="entry.price">
        <!--<input type="number" min="0.00" max="10000.00" step="0.01" />-->
      </td>

      <!--Account-->
      <td>
        <select id="newPlannedTransactionAccountSelects"
                *ngFor="let entry of newPlannedTransaction.accountPriceEntries"
                class="form-control"
                [(ngModel)]="entry.account">
          <ng-container *ngFor="let account of accounts">
            <option *ngIf="!account.archived"
                    [ngValue]="account">
              {{account.name}}
            </option>
          </ng-container>
        </select>
      </td>

      <!--Category-->
      <td>
        <select id="newPlannedTransactionCategorySelect"
                class="form-control"
                [(ngModel)]="newPlannedTransaction.category">
          <option *ngFor="let category of categories"
                  [ngValue]="category">
            {{category.name}}
          </option>
        </select>
      </td>

      <td id="EditAccountSaveExitBtn">
        <button id="newTransactionSaveButton"
                class="btn btn-success"
                (click)="addPlannedTransaction()">{{'button.save' | translate}}</button>
        <button class="btn btn-danger"
                (click)="addingMode=false"
                id="AddTransactionExitBtn">{{'button.exit' | translate}}</button>
      </td>
    </tr>

    <tr id="TransactionRow"
        *ngFor="let plannedTransaction of plannedTransactions | orderBy: order:reverse:'case-insensitive'">

      <!--Date-->
      <td id="DateReadOnly"
          *ngIf="!plannedTransaction.editMode">{{plannedTransaction.date | date:'dd/MM/yyyy'}}</td>
      <td *ngIf="plannedTransaction.editMode">
        <input id="EditPlannedTransactionDateInput"
               class="form-control"
               type="date"
               min="2015-01-01"
               max="2025-12-31"
               [(ngModel)]="plannedTransaction.editedPlannedTransaction.date">
      </td>

      <!--Description-->
      <td id="DescriptionReadOnly"
          *ngIf="!plannedTransaction.editMode">{{plannedTransaction.description}}</td>
      <td *ngIf="plannedTransaction.editMode">
        <input id="EditTransactionDescriptionInput"
               class="form-control"
               type="text"
               [(ngModel)]="plannedTransaction.editedPlannedTransaction.description">
      </td>

      <!--Price-->
      <td class="right aligned"
          *ngIf="!plannedTransaction.editMode">
        <p id="PricesReadOnly"
           *ngFor="let entry of plannedTransaction.accountPriceEntries">
          {{entry.price | number:'0.2'}} {{entry.account.currency.name}}
          <span *ngIf="entry.account.currency.name != 'PLN'">({{entry.pricePLN | number:'0.2'}}
            PLN)</span>
        </p>
      </td>
      <td *ngIf="plannedTransaction.editMode">
        <input id="EditTransactionPriceInput"
               *ngFor="let entry of plannedTransaction.editedPlannedTransaction.accountPriceEntries"
               class="form-control"
               type="number"
               [(ngModel)]="entry.price">
      </td>

      <!--Account-->
      <td *ngIf="!plannedTransaction.editMode">
        <p id="AccountsReadOnly"
           *ngFor="let entry of plannedTransaction.accountPriceEntries">
          {{entry.account.name}}
        </p>
      </td>
      <td *ngIf="plannedTransaction.editMode">
        <select id="EditTransactionAccountSelects"
                *ngFor="let entry of plannedTransaction.editedPlannedTransaction.accountPriceEntries"
                class="form-control"
                [(ngModel)]="entry.account">
          <option *ngFor="let account of accounts"
                  [ngValue]="account">
            {{account.name}}
          </option>
        </select>
      </td>

      <!--Category-->
      <td id="CategoryReadOnly"
          *ngIf="!plannedTransaction.editMode">
        {{plannedTransaction.category.name}}
      </td>
      <td id="EditTransactionCategorySelect"
          *ngIf="plannedTransaction.editMode">
        <select class="form-control"
                [(ngModel)]="plannedTransaction.editedPlannedTransaction.category">
          <option *ngFor="let category of categories"
                  [ngValue]="category">
            {{category.name}}
          </option>
        </select>
      </td>

      <td *ngIf="plannedTransaction.editMode">
        <button id="EditTransactionSaveBtn"
                class="btn btn-success"
                (click)="updateTransaction(plannedTransaction)">
          {{'button.save' | translate}}
        </button>
        <button id="EditTransactionExitBtn"
                class="btn btn-danger"
                (click)="plannedTransaction.editMode=false">
          {{'button.exit' | translate}}
        </button>
      </td>

      <td *ngIf="!plannedTransaction.editMode">
        <div class="dropdown">
          <button id="OptionsBtn"
                  class="btn btn-primary dropdown-toggle btn-block"
                  type="button"
                  data-toggle="dropdown">
            {{'button.options' | translate}}
            <span class="caret"></span>
          </button>
          <ul class="dropdown-menu">
            <li>
              <button id="EditBtn"
                      class="btn btn-warning btn-block"
                      (click)="onShowEditMode(plannedTransaction)">
                {{'button.edit' | translate}}
              </button>
            </li>
            <li>
              <button id="DeleteBtn"
                      class="btn btn-danger btn-block"
                      (click)="deleteTransaction(plannedTransaction)">
                {{'button.delete' | translate}}
              </button>
            </li>
          </ul>
        </div>
      </td>
    </tr>

    <tr>
      <!--Date-->
      <td>
      </td>

      <!--Description-->
      <td>
        {{ "account.total" | translate }}
      </td>

      <!--Price-->
      <td class="right aligned bold">
        <p id="PriceSummary">
          {{ allFiltredPlannedTransactionsBalance() | number:'0.2' }}</p>
      </td>

      <!--Account-->
      <td>
      </td>

      <!--Category-->
      <td>
      </td>

      <!-- Buttons -->
      <td>
      </td>
    </tr>

  </tbody>
</table>
