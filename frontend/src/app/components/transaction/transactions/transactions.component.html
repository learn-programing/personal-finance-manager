<div class="form-inline float-right">
  <select class="form-control" [(ngModel)]="originalFilter" (ngModelChange)="onFilterChange($event)">
    <option *ngFor="let filter of filters" [ngValue]="filter">
      {{filter.name}}
    </option>
  </select>
  <input class="form-control" type="text" [(ngModel)]="selectedFilter.name"/>
  <button class="btn btn-success" (click)="addFilter()">{{'transaction.save' | translate}}</button>
  <button class="btn btn-warning" (click)="updateFilter()">{{'transaction.update' | translate}}</button>
  <button class="btn btn-primary" (click)="resetFilter()">{{'transaction.reset' | translate}}</button>
  <button class="btn btn-danger" (click)="deleteFilter()">{{'transaction.delete' | translate}}</button>
</div>

<div class="float-left">
  <button class="btn btn-success" type="button" (click)="addingMode = !addingMode">
    {{'transaction.addTransaction' | translate}}
  </button>
  <button class="btn btn-primary" type="button" (click)="getTransactions()">{{'button.refresh' | translate}}</button>
</div>

<table class="table table-bordered table-striped">
  <thead class="thead-dark">
  <tr>

    <!--Date-->
    <th class="width: 25%" [class.active]="order === 'date'" (click)="setOrder('date')">
      {{'transaction.date' | translate}}
      <span [hidden]="reverse">▼</span>
      <span [hidden]="!reverse">▲</span>
    </th>

    <!--Description-->
    <th [class.active]="order === 'description'" (click)="setOrder('description')">
      {{'transaction.description' | translate}}
      <span [hidden]="reverse">▼</span>
      <span [hidden]="!reverse">▲</span>
    </th>

    <!--Price-->
    <th [class.active]="order === 'price'" (click)="setOrder('price')">
      {{ 'transaction.price' | translate}}
      <span [hidden]="reverse">▼</span>
      <span [hidden]="!reverse">▲</span>
    </th>

    <!--Account-->
    <th [class.active]="order === 'account.name'" (click)="setOrder('account.name')">
      {{'transaction.account' | translate}}
      <span [hidden]="reverse">▼</span>
      <span [hidden]="!reverse">▲</span>
    </th>

    <!--Category-->
    <th [class.active]="order === 'category.name'" (click)="setOrder('category.name')">
      {{'transaction.category' | translate}}
      <span [hidden]="reverse">▼</span>
      <span [hidden]="!reverse">▲</span>
    </th>

    <th>
    </th>
  </tr>

  </thead>
  <tbody>

  <!-- Filters -->
  <tr>

    <!--Date-->
    <td>
      <input class="form-control" type="date" min="2015-01-01" max="2025-12-31" [(ngModel)]="selectedFilter.dateFrom"
             (ngModelChange)="filterTransactions()">
      <input class="form-control" type="date" min="2015-01-01" max="2025-12-31" [(ngModel)]="selectedFilter.dateTo"
             (ngModelChange)="filterTransactions()">
    </td>

    <!--Description-->
    <td>
      <input class="form-control" type="text" [(ngModel)]="selectedFilter.description" (ngModelChange)="filterTransactions()">
    </td>

    <!--Price-->
    <td>
      <input class="form-control" type="number" [(ngModel)]="selectedFilter.priceFrom" (ngModelChange)="filterTransactions()">
      <input class="form-control" type="number" [(ngModel)]="selectedFilter.priceTo" (ngModelChange)="filterTransactions()">
    </td>

    <!--Account-->
    <td>
      <select multiple class="form-control" [(ngModel)]="selectedFilter.accounts" (ngModelChange)="filterTransactions()">
        <option *ngFor="let account of accounts" [ngValue]="account">
          {{account.name}}
        </option>
      </select>
    </td>

    <!--Category-->
    <td>
      <select multiple class="form-control" [(ngModel)]="selectedFilter.categories" (ngModelChange)="filterTransactions()">
        <option *ngFor="let category of categories" [ngValue]="category">
          {{category.name}}
        </option>
      </select>
    </td>

    <td>
    </td>
  </tr>

  <tr *ngFor="let transaction of transactions | orderBy: order:reverse:'case-insensitive'">

    <!--Date-->
    <td *ngIf="!transaction.editMode">{{transaction.date | date:'dd/MM/yyyy'}}</td>
    <td *ngIf="transaction.editMode">
      <input class="form-control" type="date" min="2015-01-01" max="2025-12-31" [(ngModel)]="transaction.editedTransaction.date">
    </td>

    <!--Description-->
    <td *ngIf="!transaction.editMode">{{transaction.description}}</td>
    <td *ngIf="transaction.editMode">
      <input class="form-control" type="text" [(ngModel)]="transaction.editedTransaction.description">
    </td>

    <!--Price-->
    <td class="right aligned" *ngIf="!transaction.editMode"><p *ngFor="let entry of transaction.accountPriceEntries">{{entry.price | number:'0.2'}}</p></td>
    <td *ngIf="transaction.editMode">
      <input *ngFor="let entry of transaction.editedTransaction.accountPriceEntries" class="form-control" type="number" [(ngModel)]="entry.price">
    </td>

    <!--Account-->
    <td *ngIf="!transaction.editMode"><p *ngFor="let entry of transaction.accountPriceEntries">{{entry.account.name}}</p></td>
    <td *ngIf="transaction.editMode">
      <select *ngFor="let entry of transaction.editedTransaction.accountPriceEntries" class="form-control" [(ngModel)]="entry.account">
        <option *ngFor="let account of accounts" [ngValue]="account">
          {{account.name}}
        </option>
      </select>
    </td>

    <!--Category-->
    <td *ngIf="!transaction.editMode">{{transaction.category.name}}</td>
    <td *ngIf="transaction.editMode">
      <select class="form-control" [(ngModel)]="transaction.editedTransaction.category">
        <option *ngFor="let category of categories" [ngValue]="category">
          {{category.name}}
        </option>
      </select>
    </td>

    <td *ngIf="transaction.editMode">
      <button class="btn btn-success" (click)="updateTransaction(transaction)">{{'button.save' | translate}}</button>
      <button class="btn btn-danger" (click)="transaction.editMode=false">{{'button.exit' | translate}}</button>
    </td>

    <td *ngIf="!transaction.editMode">
      <div class="dropdown">
        <button class="btn btn-primary dropdown-toggle btn-block" type="button" data-toggle="dropdown">{{'button.options' | translate}}
          <span class="caret"></span>
        </button>
        <ul class="dropdown-menu">
          <li>
            <button class="btn btn-warning btn-block" (click)="onShowEditMode(transaction)">{{'button.edit' | translate}}</button>
          </li>
          <li>
            <button class="btn btn-danger btn-block" (click)="deleteTransaction(transaction)">{{'button.delete' | translate}}</button>
          </li>
        </ul>
      </div>
    </td>
  </tr>


  <tr *ngIf="addingMode">
    <!--Date-->
    <td>
      <input class="form-control" type="date" min="2015-01-01" max="2025-12-31" [(ngModel)]="newTransaction.date">
    </td>

    <!--Description-->
    <td>
      <input class="form-control" type="text" [(ngModel)]="newTransaction.description">
    </td>

    <!--Price-->
    <td>
      <input *ngFor="let entry of newTransaction.accountPriceEntries" class="form-control" type="number" [(ngModel)]="entry.price">
      <!--<input type="number" min="0.00" max="10000.00" step="0.01" />-->
    </td>

    <!--Account-->
    <td>
      <select *ngFor="let entry of newTransaction.accountPriceEntries" class="form-control" [(ngModel)]="entry.account">
        <option *ngFor="let account of accounts" [ngValue]="account">
          {{account.name}}
        </option>
      </select>
    </td>

    <!--Category-->
    <td>
      <select class="form-control" [(ngModel)]="newTransaction.category">
        <option *ngFor="let category of categories" [ngValue]="category">
          {{category.name}}
        </option>
      </select>
    </td>

    <td>
      <button class="btn btn-success" (click)="addTransaction()">{{'button.save' | translate}}</button>
      <button class="btn btn-danger" (click)="addingMode=false">{{'button.exit' | translate}}</button>
    </td>
  </tr>

  </tbody>
</table>
